<p-button
  label="Create new payment"
  i18n-label="@@create-payment"
  rounded
  icon="pi pi-money-bill"
  [iconPos]="rtlHelper.createPosition('start')()"
  [loading]="paymentStatus.isPending()"
  (click)="openDialog()"
/>

<app-fullscreen-stepper-dialog
  #createPaymentDialog
  [(dialogVisible)]="dialogVisible"
  [currentStep]="currentStep()"
  [proceedLabel]="proceedLabel()"
  [cannotProceed]="cannotProceed()"
  [queryParamStep]="'create-payment-step'"
  (goBack)="goBack()"
  (proceed)="createPayment()"
>
  <ng-template #header>
    <i class="pi pi-money-bill me-2"></i>
    <ng-container i18n="@@create-payment">Create new payment</ng-container>
    - {{ today | date: 'shortDate' }}
  </ng-template>
  <ng-template #step>
    <p
      i18n
      class="mb-5"
    >
      Below is a table of all
      <app-colored-chip
        [variant]="includedChipData.chipVariant"
        [label]="includedChipData.chipLabel"
      />
      registrations. Select registrations you would like to add to this payment.
    </p>
    <p-card>
      <app-registrations-table
        #registrationsTable
        [projectId]="projectId()"
        [localStorageKey]="
          'project-payment-registrations-table-' +
          projectId() +
          '-' +
          today.toISOString()
        "
        [overrideFilters]="overrideFilters"
        [showSelectionInHeader]="true"
      />
    </p-card>
  </ng-template>
  <ng-template #step>
    <div data-testid="create-payment-excel-fsp-instructions">
      @if (paymentHasExcelFsp()) {
        <p i18n>Review payment summary and follow the next steps:</p>
        <ol class="mt-2 list-decimal ps-6">
          <li i18n>
            Click start payment, this will direct you to the payment page.
          </li>
          <li i18n>
            Export the FSP instructions from the payment page. This is only
            possible once the payment is no longer in progress.
          </li>
          <li i18n>
            Save the exported XLSX-file in the format required by the Financial
            Service Provider.
          </li>
          <li i18n>
            Upload the file to the Financial Service Providerâ€™s portal.
          </li>
        </ol>
      } @else {
        <p i18n>Review summary and click start payment.</p>
      }
      <p-card class="relative mt-5 block [&_.p-card-body]:py-2">
        <app-data-list
          [data]="paymentSummaryData()"
          [hideBottomBorder]="true"
        />
        @if (paymentHasIntegratedFsp()) {
          <p-button
            text
            plain
            icon="pi pi-ellipsis-h"
            class="absolute end-4 top-2"
            (click)="menu.toggle($event)"
          />
          <p-menu
            #menu
            [model]="paymentSummaryMenuItems()"
            [popup]="true"
            appendTo="body"
          />
        }
      </p-card>
    </div>
  </ng-template>
</app-fullscreen-stepper-dialog>
