<app-page-layout-registration
  [programId]="programId()"
  [registrationId]="registrationId()"
>
  <div class="px-2">
    <div class="flex flex-col gap-4">
      <div class="flex items-center gap-2">
        <i
          class="pi pi-credit-card"
          style="font-size: 1rem"
        ></i>
        <p-header
          class="font-bold"
          i18n
          >No debit cards found</p-header
        >
      </div>
      <p i18n>There are no debit cards linked to this registration</p>
      <p-button
        (click)="dialogVisible.set(true)"
        rounded
        outlined
      >
        <i
          class="pi pi-link"
          style="font-size: 1rem"
        ></i>
        <p i18n>Link visa card</p>
      </p-button>
      <p-dialog
        [(visible)]="dialogVisible"
        modal
        closable
        dismissableMask
        [style]="{ width: '632px' }"
      >
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2">
            <i class="pi pi-link"></i>
            <h3 i18n>Create new card</h3>
          </div>
        </ng-template>
        <div class="flex flex-col gap-2">
          <p i18n>
            Scan the barcode in the back of the card you are handing over to the
            registration, or manually fill in the 19 digit serial number found
            below the barcode.
          </p>
          <div class="py-1"></div>
          <p-input-mask
            label="Serial number"
            i18n-label
            [(ngModel)]="tokenCode"
            placeholder="____-____-____-____-___"
            mask="9999-9999-9999-9999-999"
            [style]="{ width: '100%' }"
          ></p-input-mask>
          <div class="w-full">
            <div class="flex justify-end gap-2">
              <p-button
                i18n
                (click)="dialogVisible.set(false)"
                rounded
                outlined
                label="Cancel"
                i18n-label
                class="mt-4"
              ></p-button>
              <p-button
                i18n
                (click)="createNewCard()"
                rounded
                label="Continue"
                i18n-label
                class="mt-4"
              ></p-button>
            </div>
          </div>
        </div>
      </p-dialog>
    </div>
    @if (currentCard()) {
      <div class="my-auto ms-auto flex">
        @if (currentCardHasAction()('pause')) {
          <p-button
            label="Pause card"
            i18n-label="@@debit-card-actions-pause-card"
            rounded
            outlined
            icon="pi pi-pause"
            [iconPos]="rtlHelper.createPosition('start')()"
            class="ms-auto"
            (click)="pauseConfirmationDialog.show()"
          />
        }
        @if (currentCardHasAction()('unpause')) {
          <p-button
            label="Unpause card"
            i18n-label="@@debit-card-actions-unpause-card"
            rounded
            outlined
            icon="pi pi-play"
            [iconPos]="rtlHelper.createPosition('start')()"
            class="ms-auto"
            (click)="unpauseConfirmationDialog.show()"
          />
        }
        @if (currentCardHasAction()('reissue')) {
          <p-button
            label="Replace card"
            i18n-label="@@debit-card-actions-replace-card"
            rounded
            outlined
            icon="pi pi-refresh"
            [iconPos]="rtlHelper.createPosition('start')()"
            class="ms-4"
            (click)="reissueConfirmationDialog.show()"
          />
        }
      </div>
      <app-data-list
        [data]="walletWithCurrentCardListData()"
        data-testid="wallet-current-card-list"
      />
    }
    @if (oldCards().length > 0) {
      <div class="py-1"></div>
      <p-accordion data-testid="old-card-list">
        @for (oldCard of oldCards(); track $index) {
          <p-accordion-panel
            [value]="$index"
            class="[&_.p-accordioncontent]:px-1 [&_.p-accordionheader]:px-0 [&_.p-accordionheader]:text-black"
          >
            <p-accordion-header
              ><span class="flex items-center gap-1">
                <strong i18n>Old card:</strong>
                <span class="font-normal">
                  {{ oldCard.tokenCode }}
                </span>
                <app-colored-chip
                  [variant]="oldCard.chipVariant"
                  [label]="oldCard.chipLabel"
                /> </span
            ></p-accordion-header>
            <p-accordion-content>
              <app-data-list
                class="text-black"
                [data]="oldCard.dataList"
                [hideBottomBorder]="true"
              />
            </p-accordion-content>
          </p-accordion-panel>
        }
      </p-accordion>
    }
  </div>
</app-page-layout-registration>
<app-form-dialog
  #pauseConfirmationDialog
  header="Pause card"
  headerIcon="pi pi-pause"
  i18n-header="@@debit-card-actions-pause-card"
  acceptLabel="Pause card"
  i18n-acceptLabel="@@debit-card-actions-pause-card"
  [mutation]="changeCardPauseStatusMutation"
  [mutationData]="{ pauseStatus: true }"
>
  <p i18n>
    You're about to pause debit card number {{ currentCard()?.tokenCode }}.
  </p>
  <p i18n="@@generic-message-will-be-sent">
    A message will be sent to the registration about this update.
  </p>
</app-form-dialog>
<app-form-dialog
  #unpauseConfirmationDialog
  header="Unpause card"
  headerIcon="pi pi-play"
  i18n-header="@@debit-card-actions-unpause-card"
  acceptLabel="Unpause card"
  i18n-acceptLabel="@@debit-card-actions-unpause-card"
  [mutation]="changeCardPauseStatusMutation"
  [mutationData]="{ pauseStatus: false }"
>
  <p i18n>
    You're about to unpause debit card number {{ currentCard()?.tokenCode }}.
  </p>
  <p i18n="@@generic-message-will-be-sent">
    A message will be sent to the registration about this update.
  </p>
</app-form-dialog>
<app-form-dialog
  #reissueConfirmationDialog
  header="Replace card"
  headerIcon="pi pi-refresh"
  i18n-header="@@debit-card-actions-replace-card"
  acceptLabel="Replace card"
  i18n-acceptLabel="@@debit-card-actions-replace-card"
  [mutation]="reissueCardMutation"
  [mutationData]="undefined"
>
  <p i18n>
    You're about to replace debit card number {{ currentCard()?.tokenCode }}.
    This will block the current card and a new card will be issued.
  </p>
  <p i18n="@@generic-message-will-be-sent">
    A message will be sent to the registration about this update.
  </p>
</app-form-dialog>
