<app-page-layout-program-settings [programId]="programId()">
  <app-card-editable
    header="Program team"
    i18n-header="@@page-title-program-settings-team"
    editPencilTitle="Edit team"
    i18n-editPencilTitle
    [canEdit]="canManageAidworkers()"
    [(isEditing)]="isEditing"
  >
    <p
      i18n
      class="mb-4"
    >
      Add users to your program team and assign roles to them.
    </p>
    <app-query-table
      [items]="programUsers.data() ?? []"
      [isPending]="programUsers.isPending()"
      [columns]="columns()"
      localStorageKey="program-team-table"
      [contextMenuItems]="isEditing() ? contextMenuItems() : undefined"
      (updateContextMenuItem)="selectedUser.set($event)"
      [globalFilterFields]="['username', 'allRolesLabel', 'scope']"
      [initialSortField]="'username'"
    >
      @if (isEditing()) {
        <div table-actions>
          <p-button
            label="Add user to team"
            i18n-label
            rounded
            outlined
            icon="pi pi-plus"
            [iconPos]="rtlHelper.createPosition('start')()"
            (click)="openForm('add')"
          />
        </div>
      }
    </app-query-table>
    <app-add-program-team-user-dialog
      #addUserDialog
      [programId]="programId()"
      [enableScope]="enableScope()"
      [userToEdit]="formMode() === 'edit' ? selectedUser() : undefined"
    />
  </app-card-editable>
</app-page-layout-program-settings>
<app-form-dialog
  #removeUserConfirmationDialog
  header="Remove user from team"
  i18n-header
  headerIcon="pi pi-trash"
  proceedLabel="Remove user"
  i18n-proceedLabel="@@remove-user-button"
  [mutation]="removeUserMutation"
  [mutationData]="{ userId: selectedUser()?.id }"
>
  <p i18n>
    You're about to remove
    <b>{{ selectedUser()?.username }}</b> ({{ selectedUser()?.allRolesLabel }})
    from your team.<br />They will not have access to the program anymore.
  </p>
</app-form-dialog>
