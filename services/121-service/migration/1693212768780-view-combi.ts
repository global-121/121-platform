import { MigrationInterface, QueryRunner } from "typeorm";

export class ViewCombi1693212768780 implements MigrationInterface {
    name = 'ViewCombi1693212768780'

    public async up(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`DELETE FROM "121-service"."typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","registration_view_entity","121-service"]);
        await queryRunner.query(`DROP VIEW "121-service"."registration_view_entity"`);
        await queryRunner.query(`CREATE VIEW "121-service"."registration_view_entity" AS SELECT "registration"."id" AS "id", "registration"."programId" AS "programId", "registration"."registrationStatus" AS "status", "registration"."referenceId" AS "referenceId", "registration"."phoneNumber" AS "phoneNumber", "registration"."preferredLanguage" AS "preferredLanguage", "registration"."inclusionScore" AS "inclusionScore", "registration"."paymentAmountMultiplier" AS "paymentAmountMultiplier", "registration"."note" AS "note", "registration"."noteUpdated" AS "noteUpdated", "registration"."registrationProgramId" AS "registrationProgramId", "registration"."maxPayments" AS "maxPayments", registration_materialized."amountPaymentsReceived" AS "amountPaymentsReceived", registration_materialized."financialServiceProvider" AS "financialServiceProvider", registration_materialized."fspDisplayNamePortal" AS "fspDisplayNamePortal", registration_materialized."lastTransactionCreated" AS "lastTransactionCreated", registration_materialized."lastTransactionPaymentNumber" AS "lastTransactionPaymentNumber", registration_materialized."lastTransactionStatus" AS "lastTransactionStatus", registration_materialized."lastTransactionAmount" AS "lastTransactionAmount", registration_materialized."lastTransactionErrorMessage" AS "lastTransactionErrorMessage", registration_materialized."lastTransactionCustomData" AS "lastTransactionCustomData", registration_materialized."importedDate" AS "importedDate", registration_materialized."registeredDate" AS "registeredDate", registration_materialized."invitedDate" AS "invitedDate", registration_materialized."startedRegistrationDate" AS "startedRegistrationDate", registration_materialized."selectedForValidationDate" AS "selectedForValidationDate", registration_materialized."validationDate" AS "validationDate", registration_materialized."inclusionDate" AS "inclusionDate", registration_materialized."rejectionDate" AS "rejectionDate", registration_materialized."noLongerEligibleDate" AS "noLongerEligibleDate", registration_materialized."registeredWhileNoLongerEligibleDate" AS "registeredWhileNoLongerEligibleDate", "registration_materialized"."inclusionEndDate" AS "inclusionEndDate", "registration_materialized"."deleteDate" AS "deleteDate", "registration_materialized"."completedDate" AS "completedDate", "registration_materialized"."lastMessageStatus" AS "lastMessageStatus", "registration_materialized"."lastMessageType" AS "lastMessageType" FROM "121-service"."registration_materialized_view_entity" "registration_materialized" LEFT JOIN "121-service"."registration" "registration" ON "registration"."id" = "registration_materialized"."id" ORDER BY "registration"."registrationProgramId" ASC`);
        await queryRunner.query(`INSERT INTO "121-service"."typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["121-service","VIEW","registration_view_entity","SELECT \"registration\".\"id\" AS \"id\", \"registration\".\"programId\" AS \"programId\", \"registration\".\"registrationStatus\" AS \"status\", \"registration\".\"referenceId\" AS \"referenceId\", \"registration\".\"phoneNumber\" AS \"phoneNumber\", \"registration\".\"preferredLanguage\" AS \"preferredLanguage\", \"registration\".\"inclusionScore\" AS \"inclusionScore\", \"registration\".\"paymentAmountMultiplier\" AS \"paymentAmountMultiplier\", \"registration\".\"note\" AS \"note\", \"registration\".\"noteUpdated\" AS \"noteUpdated\", \"registration\".\"registrationProgramId\" AS \"registrationProgramId\", \"registration\".\"maxPayments\" AS \"maxPayments\", registration_materialized.\"amountPaymentsReceived\" AS \"amountPaymentsReceived\", registration_materialized.\"financialServiceProvider\" AS \"financialServiceProvider\", registration_materialized.\"fspDisplayNamePortal\" AS \"fspDisplayNamePortal\", registration_materialized.\"lastTransactionCreated\" AS \"lastTransactionCreated\", registration_materialized.\"lastTransactionPaymentNumber\" AS \"lastTransactionPaymentNumber\", registration_materialized.\"lastTransactionStatus\" AS \"lastTransactionStatus\", registration_materialized.\"lastTransactionAmount\" AS \"lastTransactionAmount\", registration_materialized.\"lastTransactionErrorMessage\" AS \"lastTransactionErrorMessage\", registration_materialized.\"lastTransactionCustomData\" AS \"lastTransactionCustomData\", registration_materialized.\"importedDate\" AS \"importedDate\", registration_materialized.\"registeredDate\" AS \"registeredDate\", registration_materialized.\"invitedDate\" AS \"invitedDate\", registration_materialized.\"startedRegistrationDate\" AS \"startedRegistrationDate\", registration_materialized.\"selectedForValidationDate\" AS \"selectedForValidationDate\", registration_materialized.\"validationDate\" AS \"validationDate\", registration_materialized.\"inclusionDate\" AS \"inclusionDate\", registration_materialized.\"rejectionDate\" AS \"rejectionDate\", registration_materialized.\"noLongerEligibleDate\" AS \"noLongerEligibleDate\", registration_materialized.\"registeredWhileNoLongerEligibleDate\" AS \"registeredWhileNoLongerEligibleDate\", \"registration_materialized\".\"inclusionEndDate\" AS \"inclusionEndDate\", \"registration_materialized\".\"deleteDate\" AS \"deleteDate\", \"registration_materialized\".\"completedDate\" AS \"completedDate\", \"registration_materialized\".\"lastMessageStatus\" AS \"lastMessageStatus\", \"registration_materialized\".\"lastMessageType\" AS \"lastMessageType\" FROM \"121-service\".\"registration_materialized_view_entity\" \"registration_materialized\" LEFT JOIN \"121-service\".\"registration\" \"registration\" ON \"registration\".\"id\" = \"registration_materialized\".\"id\" ORDER BY \"registration\".\"registrationProgramId\" ASC"]);
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`DELETE FROM "121-service"."typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","registration_view_entity","121-service"]);
        await queryRunner.query(`DROP VIEW "121-service"."registration_view_entity"`);
        await queryRunner.query(`CREATE VIEW "121-service"."registration_view_entity" AS SELECT "registration"."id" AS "id", "registration"."programId" AS "programId", "registration"."registrationStatus" AS "status", "registration"."referenceId" AS "referenceId", "registration"."phoneNumber" AS "phoneNumber", "registration"."preferredLanguage" AS "preferredLanguage", "registration"."inclusionScore" AS "inclusionScore", "registration"."paymentAmountMultiplier" AS "paymentAmountMultiplier", "registration"."note" AS "note", "registration"."noteUpdated" AS "noteUpdated", "registration"."registrationProgramId" AS "registrationProgramId", "registration"."maxPayments" AS "maxPayments", registration_materialized."financialServiceProvider" AS "financialServiceProvider", registration_materialized."fspDisplayNamePortal" AS "fspDisplayNamePortal", registration_materialized."lastTransactionCreated" AS "lastTransactionCreated", registration_materialized."lastTransactionPaymentNumber" AS "lastTransactionPaymentNumber", registration_materialized."lastTransactionStatus" AS "lastTransactionStatus", registration_materialized."lastTransactionAmount" AS "lastTransactionAmount", registration_materialized."lastTransactionErrorMessage" AS "lastTransactionErrorMessage", registration_materialized."lastTransactionCustomData" AS "lastTransactionCustomData", registration_materialized."importedDate" AS "importedDate", registration_materialized."registeredDate" AS "registeredDate", registration_materialized."invitedDate" AS "invitedDate", registration_materialized."startedRegistrationDate" AS "startedRegistrationDate", registration_materialized."selectedForValidationDate" AS "selectedForValidationDate", registration_materialized."validationDate" AS "validationDate", registration_materialized."inclusionDate" AS "inclusionDate", registration_materialized."rejectionDate" AS "rejectionDate", registration_materialized."noLongerEligibleDate" AS "noLongerEligibleDate", registration_materialized."registeredWhileNoLongerEligibleDate" AS "registeredWhileNoLongerEligibleDate", "registration_materialized"."inclusionEndDate" AS "inclusionEndDate", "registration_materialized"."deleteDate" AS "deleteDate", "registration_materialized"."completedDate" AS "completedDate", "registration_materialized"."lastMessageStatus" AS "lastMessageStatus", "registration_materialized"."lastMessageType" AS "lastMessageType" FROM "121-service"."registration_materialized_view_entity" "registration_materialized" LEFT JOIN "121-service"."registration" "registration" ON "registration"."id" = "registration_materialized"."id" ORDER BY "registration"."registrationProgramId" ASC`);
        await queryRunner.query(`INSERT INTO "121-service"."typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["121-service","VIEW","registration_view_entity","SELECT \"registration\".\"id\" AS \"id\", \"registration\".\"programId\" AS \"programId\", \"registration\".\"registrationStatus\" AS \"status\", \"registration\".\"referenceId\" AS \"referenceId\", \"registration\".\"phoneNumber\" AS \"phoneNumber\", \"registration\".\"preferredLanguage\" AS \"preferredLanguage\", \"registration\".\"inclusionScore\" AS \"inclusionScore\", \"registration\".\"paymentAmountMultiplier\" AS \"paymentAmountMultiplier\", \"registration\".\"note\" AS \"note\", \"registration\".\"noteUpdated\" AS \"noteUpdated\", \"registration\".\"registrationProgramId\" AS \"registrationProgramId\", \"registration\".\"maxPayments\" AS \"maxPayments\", registration_materialized.\"financialServiceProvider\" AS \"financialServiceProvider\", registration_materialized.\"fspDisplayNamePortal\" AS \"fspDisplayNamePortal\", registration_materialized.\"lastTransactionCreated\" AS \"lastTransactionCreated\", registration_materialized.\"lastTransactionPaymentNumber\" AS \"lastTransactionPaymentNumber\", registration_materialized.\"lastTransactionStatus\" AS \"lastTransactionStatus\", registration_materialized.\"lastTransactionAmount\" AS \"lastTransactionAmount\", registration_materialized.\"lastTransactionErrorMessage\" AS \"lastTransactionErrorMessage\", registration_materialized.\"lastTransactionCustomData\" AS \"lastTransactionCustomData\", registration_materialized.\"importedDate\" AS \"importedDate\", registration_materialized.\"registeredDate\" AS \"registeredDate\", registration_materialized.\"invitedDate\" AS \"invitedDate\", registration_materialized.\"startedRegistrationDate\" AS \"startedRegistrationDate\", registration_materialized.\"selectedForValidationDate\" AS \"selectedForValidationDate\", registration_materialized.\"validationDate\" AS \"validationDate\", registration_materialized.\"inclusionDate\" AS \"inclusionDate\", registration_materialized.\"rejectionDate\" AS \"rejectionDate\", registration_materialized.\"noLongerEligibleDate\" AS \"noLongerEligibleDate\", registration_materialized.\"registeredWhileNoLongerEligibleDate\" AS \"registeredWhileNoLongerEligibleDate\", \"registration_materialized\".\"inclusionEndDate\" AS \"inclusionEndDate\", \"registration_materialized\".\"deleteDate\" AS \"deleteDate\", \"registration_materialized\".\"completedDate\" AS \"completedDate\", \"registration_materialized\".\"lastMessageStatus\" AS \"lastMessageStatus\", \"registration_materialized\".\"lastMessageType\" AS \"lastMessageType\" FROM \"121-service\".\"registration_materialized_view_entity\" \"registration_materialized\" LEFT JOIN \"121-service\".\"registration\" \"registration\" ON \"registration\".\"id\" = \"registration_materialized\".\"id\" ORDER BY \"registration\".\"registrationProgramId\" ASC"]);
    }

}
